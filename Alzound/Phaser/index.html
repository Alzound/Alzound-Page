<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.17.0/dist/phaser.js"></script>
</head>
<body>

    <script>
   


    
class BulletHell extends Phaser.Scene
{
    constructor ()
    {
        super();

        this.bullets;
        this.player;
    }

    preload ()
    {
        this.load.image('Chaos', 'BackgroundChaos.png');
        this.load.image('Amy', 'amy.png');
        this.load.image('Bubble', 'bubbleText.png');
        this.load.image('bullet', 'alert2.png');
        this.load.image('player', 'eye3.png'); 
        this.load.image('BHypnotic', 'B_hypnotic.png');
        this.load.image('BHypnotic1', 'B_hypnotic1.png');
        this.load.image('brain', 'brain2.png'); 


        this.load.spritesheet('balls', 'nube.png', { frameWidth: 17, frameHeight: 17 });
    }

    create ()
    {
        //Bounds of the world, because...
        this.physics.world.setBoundsCollision(true, true, true, true);

        
        //Background
        this.add.image(1920/2, 1080/2, 'BHypnotic');
        //Enemy
        this.add.image(1920/2, 1080/2, 'brain');
        //Story character
        this.add.image(200, 900, 'Amy');

        //Enemy health bar
        let EhealthBar = this.makeBar(750, 325, 0x01fe00);
        this.setValue(EhealthBar, 200);

        //Obstacles
        const circle = new Phaser.Geom.Circle(1920/2, 1080/2, 220);

        this.group = this.add.group({ key: 'balls', frame: [0, 0, 0], repeat: 5 });

        Phaser.Actions.PlaceOnCircle(this.group.getChildren(), circle);

        this.tween = this.tweens.addCounter({
            from: 600,
            to: 100,
            duration: 3000,
            delay: 2000,
            ease: 'Sine.easeInOut',
            repeat: -1,
            yoyo: true
        });
        
        
        
        //const text = this.add.text(450, 900, 'Text', { font: '25px Courier', fill: '#FFFFFF' });
        this.bullets = new Bullets(this);

        this.player = this.add.image(0, 1, 'player');
        
        //const circle = new Phaser.Geom.Circle(0, 0, 0);

        this.input.on('pointermove', (pointer) => {

            this.player.x = pointer.x ;
            this.player.y = pointer.y ; 

        });

        this.input.on('pointerdown', (pointer) => {

            this.bullets.fireBullet(this.player.x, this.player.y);

        });

        
    }

    update ()
        {
            Phaser.Actions.RotateAroundDistance(this.group.getChildren(), { x: 1920/2, y: 1080/2 }, 0.1, this.tween.getValue());
        }

    makeBar(x, y,color) 
    {
        //draw the bar
        let bar = this.add.graphics();

        //color the bar
        bar.fillStyle(color, 1);

        //fill the bar with a rectangle
        bar.fillRect(0, 0, 200, 30);
        
        //position the bar
        bar.x = x;
        bar.y = y;

        //return the bar
        return bar;
    }

    setValue(bar,percentage) 
    {
        
        //scale the bar
        bar.scaleX = percentage/100;
        
        
        if(bar.scaleX > 50 && bar.scaleX < 75)
        {
            EhealthBar = this.makeBar(750, 325,  0xffff00)
        }

        if(bar.scaleX > 30 && bar.scaleX < 50)
        {
            EhealthBar = this.makeBar(750, 325,  0xff9004)
        }
        /*
        if(bar.scaleX > 0 && bar.scaleX < 30)
        {
            EhealthBar = this.makeBar(750, 325,  0xff0304)
        }
        */
        
        
    }

}


    class Bullet extends Phaser.Physics.Arcade.Sprite
{
    constructor (scene, x, y)
    {
        super(scene, x, y, 'bullet');
    }

    fire (x, y)
    {
        this.body.reset(x, y);

        this.setActive(true);
        this.setVisible(true);

        this.setVelocityY(-800);
    }

    preUpdate (time, delta)
    {
        super.preUpdate(time, delta);

        if (this.y <= -32)
        {
            this.setActive(false);
            this.setVisible(false);
        }
    }
}

class Bullets extends Phaser.Physics.Arcade.Group
{
    constructor (scene)
    {
        super(scene.physics.world, scene);

        this.createMultiple({
            frameQuantity: 100,
            key: 'bullet',
            active: false,
            visible: false,
            classType: Bullet
        });
    }

    fireBullet (x, y)
    {
        let bullet = this.getFirstDead(false);

        if (bullet)
        {
            bullet.fire(x, y);
        }
    }
}





    var config = {
        type: Phaser.AUTO,
        
        width: 1920,
        height: 1080,
        parent:'phaser-example',
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0, x: 0 }
            }
        },
        scene: BulletHell
        /*
        scene:
        {
            preload: preload,
            create: create,
            
        
        }
          */  
           
    };

    var game = new Phaser.Game(config);
    </script>

</body>
</html>